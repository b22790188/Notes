---
date : 2023-04-09
alias : []
---

---

Multi-processes vs multi-threads
+ Process creation is `heavy-weight` while thread creation is `light-weight`
+ Simplify code , increasing efficiency

Multi-threads benefits
+ Responsiveness
+ Resource Sharing
+ Economy - cheaper than process creation
+ Scalablility

## Multicore Programming

+ `concurrenct vs parallelism`
	+ parallelism on a multi-core system can perform more than one task `simultaneously`

+ `Type of parallelism`
	+ Data parallelism - focuses on parallelizing `a single operation across multiple data elements`
	+ Task parallelism - focuses on `parallelizing multiple operations across multiple data elements`
	
## Multithreading Models
+ User threads
	+ management done by user-level thread library
	+ Pthreads , WIndows threads, Java threads
+ Kernel threads
	+ Supported by the kernel


+ Many-to-one 
	+ Solaries Green Threads
+ one-to-one
	+ Windows , linux
+ Many-to-Many
+ Two-level - similiar to M:M, except that it allows a user thread to be bound to kernel thread

## Thread library

+ Library in user space
+ Kernel-level library

+ Pthreads 
	+ A POSIX standard API for thread creatoin and synchronization
		+ Specification , not implementation


## Implicit Threading

Growing in popularity as numbers of threads increase, program correctness more difficult with explicit threads `Creation and management of threads done by compilers and run-time libraries rather than programmers`

+ Thread pools
	+ slightly faster to serve a request with existing thread
	+ allows the number of threads in the application to be bound to the size of pool
	+ allows different strategies for running task

+ Fork-Join Parallelism

## Threading Issues

Does `fork()` duplicate only the calling thread or all threads?
`exec()` usually works as normal â€“ replace the running process `including all threads`

Signals : used to `notify`  a process that a particular event has occurred
+ Signals Handling
	+ Signal handled by `signal handler`
	+ generated by particular event
	+ delivered to a process

+ Types of signal handler
	+ default
		+ Every signals has it, can be `override by user-defineed signal handler`
	+ user-defined

## Thread Cancellatoin

+ Target thread
	+ thread to be canceled
+ Types of cancellation
	+ Asynchronous cancellation
		+ Terminated the target `immediately`
	+ Deferred cancellation 
		+ `periodically` check if it should be cancelled
		+ Default type is `Deffered`
		+ Cancellation only occurs when thread reaches `cancellation point` , then `cleanup handler` is invoked

## Thread-Local Storage

Allows each thread to `have its own copy of data`

## Scheduler Activatoins

+ `lightweight process(LWP)` 
	+ served as a intermediate data structure between user and kernel threads
	+ as `virtual processor` can schedule user thread to run
	+ attached to kernel thread

+ upcalls
	+ communication mechanism from the kernel to the upcall handler
	+ allows a app to `maintain correct number kernel threads`

## OS Examples

+ Windows API
	+ one-to-one mapping , kernel-level

+ The primary data structures of a thread include
	+ ETHREAD (executive thread block)
		+ contains thread information such as , priority , affinity context switch data
	+ KTHREAD (kernel thread block)
		+ used by kernel to run systme-level code
	+ TEB (thread environment block)
		+ contain thread-specific data , such as `stack`, `TLS` 
		+ is accessiable by user space


+ LInux Threads
	+ creation is done through `clone()`
